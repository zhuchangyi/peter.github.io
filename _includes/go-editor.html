<div class="go-editor-container">
    <div id="editor" style="width: 100%; min-height: 200px;"></div>
    <div class="button-container">
        <button id="run" class="run-button">Run</button>
        <button id="reset" class="reset-button">Reset</button>
    </div>
    <div id="output-container">
        <div class="output-header">
            Output <span id="execution-time"></span>
        </div>
        <pre id="output"></pre>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
<script>
require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.31.1/min/vs' }});
require(['vs/editor/editor.main'], function() {
    var editor = monaco.editor.create(document.getElementById('editor'), {
        value: 'package main\n\nimport "fmt"\n\nfunc main() {\n\tfmt.Println("Hello, World!")\n}',
        language: 'go',
        theme: 'vs-dark',
        fontSize: 16,
        lineHeight: 24,
        automaticLayout: true, // 允许编辑器自动调整布局
        scrollBeyondLastLine: false, // 禁止滚动超过最后一行
        minimap: { enabled: false } // 禁用小地图以节省空间
    });

    // 函数：调整编辑器高度
    function adjustEditorHeight() {
        var contentHeight = Math.min(600, Math.max(200, editor.getContentHeight()));
        editor.layout({ width: editor.getLayoutInfo().width, height: contentHeight });
    }

    // 监听编辑器内容变化
    editor.onDidChangeModelContent(adjustEditorHeight);

    // 初始调整
    adjustEditorHeight();

    document.getElementById('run').onclick = function() {
        var startTime = performance.now();
        var code = editor.getValue();
        fetch('http://orjp.leatherpigeon.shop:8080/run', {  
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ code: code })
        })
        .then(response => response.json())
        .then(data => {
            var endTime = performance.now();
            document.getElementById('output').textContent = data.output;
            document.getElementById('execution-time').textContent = `${((endTime - startTime) / 1000).toFixed(2)}s`;
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('output').textContent = 'Error: ' + error;
        });
    };

    document.getElementById('reset').onclick = function() {
        editor.setValue('package main\n\nimport "fmt"\n\nfunc main() {\n\tfmt.Println("Hello, World!")\n}');
        adjustEditorHeight();
    };
});
</script>